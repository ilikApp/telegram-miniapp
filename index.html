<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gl√ºcksrad</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h1>üé° Gl√ºcksrad</h1>
<button id="addPointsBtn">+10 Punkte</button>
  <p id="username"></p>
  <p id="points"></p>

  <button id="spin">Rad drehen</button>

  <div id="betBox" style="display:none;">
    <p>Wie viele Punkte setzt du?</p>
    <input id="betInput" type="number" min="1">
    <button onclick="startRisk()">Einsatz best√§tigen</button>
  </div>

  <div id="questionBox" style="display:none;">
    <p id="questionText"></p>
    <button onclick="answer(0)">Antwort A</button>
    <button onclick="answer(1)">Antwort B</button>
    <button onclick="answer(2)">Antwort C</button>
  </div>

  <p id="result"></p>

  <script>
    const tg = Telegram.WebApp;
const USER_ID = "user_" + (tg.initDataUnsafe.user?.id || Math.random().toString(36).slice(2));
    tg.ready();

    const user = tg.initDataUnsafe.user || { username: "Gast" };
    let points = 0;

fetch("https://gluecksrad-backend.onrender.com/me/" + USER_ID)
  .then(res => res.json())
  .then(data => {
    points = data.points ?? 0;
    update();
  });

    let currentQuestion = null;
    let bet = 0;
    let riskMode = false;

    const questions = [
      {
        q: "Was ist die Hauptstadt von Frankreich?",
        a: ["Berlin", "Paris", "Rom"],
        correct: 1
      },
      {
        q: "5 √ó 5 = ?",
        a: ["20", "25", "30"],
        correct: 1
      },
      {
        q: "Welche Farbe hat Gras?",
        a: ["Blau", "Gr√ºn", "Gelb"],
        correct: 1
      }
    ];

    function update() {
      document.getElementById("username").innerText = "Benutzer: " + user.username;
      document.getElementById("points").innerText = "Punkte: " + points;
    }

    update();
fetch("https://gluecksrad-backend.onrender.com/me/:id" + USER_ID, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ points })
});

document.getElementById("addPointsBtn").onclick = () => {
  points += 10;
  document.getElementById("result").innerText = "‚ûï 10 Punkte";
  update();
fetch("https://gluecksrad-backend.onrender.com/me/:id" + USER_ID, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ points })
});
};
    document.getElementById("spin").onclick = () => {
      resetUI();
      const r = Math.random();

      if (r < 0.4) {
        points += 10;
        document.getElementById("result").innerText = "‚ûï 10 Punkte";
      } 
      else if (r < 0.7) {
        currentQuestion = randomQuestion();
        showQuestion();
      } 
      else {
        document.getElementById("betBox").style.display = "block";
        document.getElementById("result").innerText = "üé≤ Risiko-Modus!";
      }

      update();
fetch("https://gluecksrad-backend.onrender.com/me/:id" + USER_ID, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ points })
});
    };

    function startRisk() {
      bet = parseInt(document.getElementById("betInput").value);
      if (!bet || bet <= 0 || bet > points) {
        alert("Ung√ºltiger Einsatz");
        return;
      }
      riskMode = true;
      document.getElementById("betBox").style.display = "none";
      currentQuestion = randomQuestion();
      showQuestion();
    }

    function showQuestion() {
      document.getElementById("questionText").innerText = currentQuestion.q;
      document.querySelectorAll("#questionBox button").forEach((btn, i) => {
        btn.innerText = currentQuestion.a[i];
      });
      document.getElementById("questionBox").style.display = "block";
    }

    function answer(index) {
      if (!currentQuestion) return;

      if (index === currentQuestion.correct) {
        if (riskMode) {
          points += bet;
          document.getElementById("result").innerText = "üî• Richtig! Einsatz gewonnen";
        } else {
          points += 5;
          document.getElementById("result").innerText = "‚úÖ Richtig! +5 Punkte";
        }
      } else {
        if (riskMode) {
          points -= bet;
          document.getElementById("result").innerText = "üí• Falsch! Einsatz verloren";
        } else {
          document.getElementById("result").innerText = "‚ùå Falsch!";
        }
      }

      resetState();
         }

    function resetUI() {
      document.getElementById("betBox").style.display = "none";
      document.getElementById("questionBox").style.display = "none";
      document.getElementById("result").innerText = "";
    }

    function resetState() {
      currentQuestion = null;
      bet = 0;
      riskMode = false;
      document.getElementById("questionBox").style.display = "none";
    }

    function randomQuestion() {
      return questions[Math.floor(Math.random() * questions.length)];
    }
  </script>
</body>
</html>
